%%{init: {'theme':'base', 'themeVariables': {'fontSize':'20px'}}}%%
flowchart TB
    User([React Native App<br/>Mobile Client])
    
    User -->|HTTP REST API| Routes
    
    Routes[API Routes<br/>/catalog<br/>/checkout<br/>/auth/login<br/>/auth/token]
    
    Routes --> Middleware[Middleware<br/>Rate Limiting<br/>CORS<br/>JWT Auth<br/>Error Handler]
    
    Middleware --> AuthService[Auth Service<br/>OAuth Flow<br/>JWT Tokens]
    Middleware --> CatalogService[Catalog Service<br/>Products<br/>Pagination]
    Middleware --> CheckoutService[Checkout Service<br/>Orders<br/>Payment<br/>Inventory]
    
    AuthService --> UsersMap[(Users Map<br/>email → User<br/>In-Memory)]
    AuthService --> AuthCodesMap[(Auth Codes Map<br/>code → AuthCode<br/>In-Memory)]
    
    CatalogService --> ProductsMap[(Products Map<br/>productId → Product<br/>In-Memory)]
    
    CheckoutService --> ProductsMap
    
    Shopify[Shopify API<br/>Source of Truth] -.->|Initial Load<br/>products.json| ProductsMap
    
    style User fill:#e1f0ff,stroke:#003d82,stroke-width:5px,font-size:20px
    
    style Routes fill:#fff4e1,stroke:#8b6914,stroke-width:5px,font-size:20px
    style Middleware fill:#fff4e1,stroke:#8b6914,stroke-width:5px,font-size:20px
    
    style AuthService fill:#e1f5e1,stroke:#2d5016,stroke-width:5px,font-size:20px
    style CatalogService fill:#e1f5e1,stroke:#2d5016,stroke-width:5px,font-size:20px
    style CheckoutService fill:#e1f5e1,stroke:#2d5016,stroke-width:5px,font-size:20px
    
    style UsersMap fill:#ffe1e1,stroke:#8b0000,stroke-width:5px,font-size:20px
    style AuthCodesMap fill:#ffe1e1,stroke:#8b0000,stroke-width:5px,font-size:20px
    style ProductsMap fill:#ffe1e1,stroke:#8b0000,stroke-width:5px,font-size:20px
    
    style Shopify fill:#f0f0f0,stroke:#666,stroke-width:5px,font-size:20px